{{template "base" .}}

{{define "title"}}Dashboard - Kiro2API{{end}}

{{define "content"}}
<div class="dashboard">
  <div class="dashboard-header">
    <h2>Token Management</h2>
    <a href="/dashboard/select-provider" class="btn btn-primary">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14"/>
      </svg>
      Add Account
    </a>
  </div>

  {{if .tokens}}
  <div class="token-list">
    {{range .tokens}}
    <div class="token-item" data-token-id="{{.ID}}">
      <div class="token-item-provider" data-label="Provider">
        <div class="provider-info">
          <span class="provider-icon">{{if eq .Provider "Google"}}🔵{{else if eq .Provider "Github"}}⚫{{else if eq .Provider "BuilderId"}}🟠{{else}}🔷{{end}}</span>
          <div>
            <div class="provider-name">{{.Provider}}</div>
            <div class="provider-method">{{.AuthMethod}}</div>
          </div>
        </div>
      </div>

      <div class="token-item-status" data-label="Status">
        <span class="status-badge status-{{.Status}}">
          {{if eq .Status "valid"}}✓ Valid{{else if eq .Status "expiring"}}⚠ Expiring{{else}}✗ Expired{{end}}
        </span>
      </div>

      <div class="token-item-expires" data-label="Expires">
        <time datetime="{{.ExpiresAt}}">{{.ExpiresAt}}</time>
      </div>

      <div class="token-item-actions">
        <button class="btn btn-sm btn-secondary" onclick="refreshToken('{{.ID}}')" title="Refresh token">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
          </svg>
          Refresh
        </button>
        <button class="btn btn-sm btn-danger" onclick="deleteToken('{{.ID}}')" title="Delete token">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          Delete
        </button>
      </div>
    </div>
    {{end}}
  </div>
  {{else}}
  <div class="empty-state">
    <div class="empty-icon">🔐</div>
    <h3>No tokens yet</h3>
    <p>Add your first authentication token to get started with Kiro2API.</p>
    <a href="/dashboard/select-provider" class="btn btn-primary">Add Your First Account</a>
  </div>
  {{end}}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" id="deleteModal">
  <div class="modal-content">
    <h3>Confirm Deletion</h3>
    <p>Are you sure you want to delete this token? This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
      <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
  <p>Processing...</p>
</div>
{{end}}
